generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Conversation {
  id         String    @id @default(cuid())
  documentId String
  title      String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  Document   Document  @relation(fields: [documentId], references: [id], onDelete: Cascade)
  Message    Message[]

  @@index([createdAt])
  @@index([documentId])
}

model Document {
  id            String          @id @default(cuid())
  filename      String
  filepath      String
  filesize      Int
  uploadedAt    DateTime        @default(now())
  Conversation  Conversation[]
  DocumentChunk DocumentChunk[]
}

model DocumentChunk {
  id           String      @id @default(cuid())
  documentId   String
  content      String
  pageNumber   Int
  chunkIndex   Int
  boundingBox  String?
  chunkType    String      @default("paragraph")
  heading      String?
  pineconeId   String?
  readingOrder Int         @default(0)
  tableData    String?
  Document     Document    @relation(fields: [documentId], references: [id], onDelete: Cascade)
  Reference    Reference[]

  @@index([documentId])
  @@index([pineconeId])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  role           String
  content        String
  createdAt      DateTime     @default(now())
  Conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  Reference      Reference[]

  @@index([conversationId])
}

model Reference {
  id            String        @id @default(cuid())
  messageId     String
  chunkId       String
  pageNumber    Int
  text          String
  relevance     Float
  citationIndex Int
  boundingBox   String?
  chunkType     String?
  DocumentChunk DocumentChunk @relation(fields: [chunkId], references: [id], onDelete: Cascade)
  Message       Message       @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}
